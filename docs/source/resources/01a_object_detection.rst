***********************
Object Detection Models
***********************

List of Object Detection Models
===============================

The table below shows the object detection models available for each task category.

+---------------+------------------------+------------------------------------------------------------+
| Category      | Model                  | Documentation                                              |
+===============+========================+============================================================+
|               | EfficientDet           | :mod:`peekingduck.pipeline.nodes.model.efficientdet`       |
+               +------------------------+------------------------------------------------------------+
| General       | YOLOv4                 | :mod:`peekingduck.pipeline.nodes.model.yolo`               |
+---------------+------------------------+------------------------------------------------------------+
|               | MTCNN                  | :mod:`peekingduck.pipeline.nodes.model.mtcnn`              |
+               +------------------------+------------------------------------------------------------+
| Face          | YOLOv4 (Face)          | :mod:`peekingduck.pipeline.nodes.model.yolo_face`          |
+---------------+------------------------+------------------------------------------------------------+
| License plate | YOLOv4 (License Plate) | :mod:`peekingduck.pipeline.nodes.model.yolo_license_plate` |
+---------------+------------------------+------------------------------------------------------------+

Benchmarks
==========

Inference Speed
---------------

The table below shows the frames per second (FPS) of each model type.

+--------------+--------+------+-------------------+-------------------+
|              |        |      | CPU               | GPU               |
|              |        |      +--------+----------+--------+----------+
| Model        | Type   | Size | single | multiple | single | multiple |
+==============+========+======+========+==========+========+==========+
|              | v4tiny | 416  | 22.42  | 21.71    | 65.24  | 57.50    |
|              +--------+------+--------+----------+--------+----------+
| YOLO         | v4     | 416  | 2.62   | 2.59     | 30.40  | 28.71    |
+--------------+--------+------+--------+----------+--------+----------+
|              | 0      | 512  | 5.24   | 5.25     | 29.51  | 29.39    |
|              +--------+------+--------+----------+--------+----------+
|              | 1      | 640  | 2.53   | 2.49     | 23.79  | 24.44    |
|              +--------+------+--------+----------+--------+----------+
|              | 2      | 768  | 1.54   | 1.50     | 19.86  | 20.51    |
|              +--------+------+--------+----------+--------+----------+
|              | 3      | 896  | 0.78   | 0.75     | 14.69  | 14.84    |
|              +--------+------+--------+----------+--------+----------+
| EfficientDet | 4      | 1024 | 0.43   | 0.42     | 11.74  | 11.88    |
+--------------+--------+------+--------+----------+--------+----------+
| MTCNN        | --     | --   | 32.42  | 18.53    | 56.35  | 51.45    |
+--------------+--------+------+--------+----------+--------+----------+

Hardware
^^^^^^^^
The following hardware were used to conduct the FPS benchmarks:
 | - ``CPU``: MacBook Pro 2017, with 2.9 GHz Quad-Core Intel Core i7 and 16GB RAM
 | - ``GPU``: NVIDIA A100, paired with 2.2 GHz 6-Core Intel Xeon CPU and 85GB RAM

Test Conditions
^^^^^^^^^^^^^^^
The following test conditions were followed:
 | - :class:`input.recorded <peekingduck.pipeline.nodes.input.recorded.Node>`, the model of
     interest, and :class:`dabble.fps <peekingduck.pipeline.nodes.dabble.fps.Node>` nodes were
     used to perform inference on videos
 | - 2 videos were used to benchmark each model, one with only 1 human (``single``), and the other
     with multiple humans (``multiple``)
 | - Both videos are about 1 minute each, recorded at ~30 FPS, which translates to about 1,800
     frames to process per video
 | - 1280×720 (HD ready) resolution was used, as a bridge between 640×480 (VGA) of poorer quality
     webcams, and 1920×1080 (Full HD) of CCTVs
 | - All unnecessary processes, such as browsers, were closed to prevent IO/resource contention

Model Accuracy
--------------

The table below shows the performance of our object detection models using the detection evaluation
metrics from COCO. Description of these metrics can be found `here <https://cocodataset.org/#detection-eval>`__.

+--------------+--------+------+------+-------------------+-------------------+-----------------+------------------+-----------------+-----------------+------------------+-------------------+-----------------+------------------+-----------------+
| Model        | Type   | Size | AP   | AP :sup:`IoU=.50` | AP :sup:`IoU=.75` | AP :sup:`small` | AP :sup:`medium` | AP :sup:`large` | AR :sup:`max=1` | AR :sup:`max=10` | AR :sup:`max=100` | AR :sup:`small` | AR :sup:`medium` | AR :sup:`large` |
+==============+========+======+======+===================+===================+=================+==================+=================+=================+==================+===================+=================+==================+=================+
|              | v4tiny | 416  | 13.4 | 24.6              | 13.1              | 3.7             | 15.4             | 20.5            | 12.9            | 16.7             | 16.8              | 4.2             | 18.7             | 26.6            |
|              +--------+------+------+-------------------+-------------------+-----------------+------------------+-----------------+-----------------+------------------+-------------------+-----------------+------------------+-----------------+
| YOLO         | v4     | 416  | 38.2 | 55.4              | 42.3              | 18.3            | 43.0             | 55.4            | 29.8            | 42.5             | 43.1              | 20.3            | 48.0             | 62.9            |
+--------------+--------+------+------+-------------------+-------------------+-----------------+------------------+-----------------+-----------------+------------------+-------------------+-----------------+------------------+-----------------+
|              | 0      | 512  | 26.4 | 39.2              | 28.8              | 6.4             | 30.2             | 44.6            | 23.0            | 30.9             | 31.1              | 6.5             | 34.8             | 53.6            |
|              +--------+------+------+-------------------+-------------------+-----------------+------------------+-----------------+-----------------+------------------+-------------------+-----------------+------------------+-----------------+
|              | 1      | 640  | 31.5 | 45.4              | 34.3              | 11.8            | 35.3             | 50.4            | 26.3            | 36.2             | 36.6              | 12.8            | 40.4             | 58.5            |
|              +--------+------+------+-------------------+-------------------+-----------------+------------------+-----------------+-----------------+------------------+-------------------+-----------------+------------------+-----------------+
|              | 2      | 768  | 34.6 | 48.8              | 38.1              | 15.4            | 38.8             | 52.5            | 28.4            | 39.5             | 39.9              | 16.9            | 44.1             | 60.6            |
|              +--------+------+------+-------------------+-------------------+-----------------+------------------+-----------------+-----------------+------------------+-------------------+-----------------+------------------+-----------------+
|              | 3      | 896  | 37.4 | 51.7              | 40.9              | 19.0            | 40.7             | 55.5            | 30.3            | 42.6             | 43.0              | 21.0            | 46.2             | 63.4            |
|              +--------+------+------+-------------------+-------------------+-----------------+------------------+-----------------+-----------------+------------------+-------------------+-----------------+------------------+-----------------+
| EfficientDet | 4      | 1024 | 40.0 | 54.4              | 44.1              | 21.3            | 44.3             | 57.2            | 31.8            | 45.4             | 46.0              | 23.5            | 49.9             | 65.1            |
+--------------+--------+------+------+-------------------+-------------------+-----------------+------------------+-----------------+-----------------+------------------+-------------------+-----------------+------------------+-----------------+

Dataset
^^^^^^^

The `MS COCO <https://cocodataset.org/#download>`__ (val 2017) dataset is used. We integrated the
COCO API into the PeekingDuck pipeline for loading the annotations and evaluating the outputs from
the models. All values are reported in percentage.

All images from the 80 object categories in the MS COCO (val 2017) dataset were processed.

Object Detection IDs
====================

.. _general-object-detection-ids:

General Object Detection
------------------------

| The tables below provide the associated indices for each class in object detectors.
| To detect all classes, specify :code:`detect_ids: ["*"]` under the object detection node configuration in `run_config.yml`.

+---------------+---------------------+----------------+---------------------+
|               | ID                  |                | ID                  |
|               +------+--------------+                +------+--------------+
| Class name    | YOLO | EfficientDet | Class name     | YOLO | EfficientDet |
+===============+======+==============+================+======+==============+
| person        | 0    | 0            | elephant       | 20   | 21           |
+---------------+------+--------------+----------------+------+--------------+
| bicycle       | 1    | 1            | bear           | 21   | 22           |
+---------------+------+--------------+----------------+------+--------------+
| car           | 2    | 2            | zebra          | 22   | 23           |
+---------------+------+--------------+----------------+------+--------------+
| motorcycle    | 3    | 3            | giraffe        | 23   | 24           |
+---------------+------+--------------+----------------+------+--------------+
| aeroplane     | 4    | 4            | backpack       | 24   | 26           |
+---------------+------+--------------+----------------+------+--------------+
| bus           | 5    | 5            | umbrella       | 25   | 27           |
+---------------+------+--------------+----------------+------+--------------+
| train         | 6    | 6            | handbag        | 26   | 30           |
+---------------+------+--------------+----------------+------+--------------+
| truck         | 7    | 7            | tie            | 27   | 31           |
+---------------+------+--------------+----------------+------+--------------+
| boat          | 8    | 8            | suitcase       | 28   | 32           |
+---------------+------+--------------+----------------+------+--------------+
| traffic light | 9    | 9            | frisbee        | 29   | 33           |
+---------------+------+--------------+----------------+------+--------------+
| fire hydrant  | 10   | 10           | skis           | 30   | 34           |
+---------------+------+--------------+----------------+------+--------------+
| stop sign     | 11   | 12           | snowboard      | 31   | 35           |
+---------------+------+--------------+----------------+------+--------------+
| parking meter | 12   | 13           | sports ball    | 32   | 36           |
+---------------+------+--------------+----------------+------+--------------+
| bench         | 13   | 14           | kite           | 33   | 37           |
+---------------+------+--------------+----------------+------+--------------+
| bird          | 14   | 15           | baseball bat   | 34   | 38           |
+---------------+------+--------------+----------------+------+--------------+
| cat           | 15   | 16           | baseball glove | 35   | 39           |
+---------------+------+--------------+----------------+------+--------------+
| dog           | 16   | 17           | skateboard     | 36   | 40           |
+---------------+------+--------------+----------------+------+--------------+
| horse         | 17   | 18           | surfboard      | 37   | 41           |
+---------------+------+--------------+----------------+------+--------------+
| sheep         | 18   | 19           | tennis racket  | 38   | 42           |
+---------------+------+--------------+----------------+------+--------------+
| cow           | 19   | 20           | bottle         | 39   | 43           |
+---------------+------+--------------+----------------+------+--------------+

+--------------+---------------------+--------------+---------------------+
|              | ID                  |              | ID                  |
|              +------+--------------+              +------+--------------+
| Class name   | YOLO | EfficientDet | Class name   | YOLO | EfficientDet |
+==============+======+==============+==============+======+==============+
| wine glass   | 40   | 45           | dining table | 60   | 66           |
+--------------+------+--------------+--------------+------+--------------+
| cup          | 41   | 46           | toilet       | 61   | 69           |
+--------------+------+--------------+--------------+------+--------------+
| fork         | 42   | 47           | tv           | 62   | 71           |
+--------------+------+--------------+--------------+------+--------------+
| knife        | 43   | 48           | laptop       | 63   | 72           |
+--------------+------+--------------+--------------+------+--------------+
| spoon        | 44   | 49           | mouse        | 64   | 73           |
+--------------+------+--------------+--------------+------+--------------+
| bowl         | 45   | 50           | remote       | 65   | 74           |
+--------------+------+--------------+--------------+------+--------------+
| banana       | 46   | 51           | keyboard     | 66   | 75           |
+--------------+------+--------------+--------------+------+--------------+
| apple        | 47   | 52           | cell phone   | 67   | 76           |
+--------------+------+--------------+--------------+------+--------------+
| sandwich     | 48   | 53           | microwave    | 68   | 77           |
+--------------+------+--------------+--------------+------+--------------+
| orange       | 49   | 54           | oven         | 69   | 78           |
+--------------+------+--------------+--------------+------+--------------+
| broccoli     | 50   | 55           | toaster      | 70   | 79           |
+--------------+------+--------------+--------------+------+--------------+
| carrot       | 51   | 56           | sink         | 71   | 80           |
+--------------+------+--------------+--------------+------+--------------+
| hot dog      | 52   | 57           | refrigerator | 72   | 81           |
+--------------+------+--------------+--------------+------+--------------+
| pizza        | 53   | 58           | book         | 73   | 83           |
+--------------+------+--------------+--------------+------+--------------+
| donut        | 54   | 59           | clock        | 74   | 84           |
+--------------+------+--------------+--------------+------+--------------+
| cake         | 55   | 60           | vase         | 75   | 85           |
+--------------+------+--------------+--------------+------+--------------+
| chair        | 56   | 61           | scissors     | 76   | 86           |
+--------------+------+--------------+--------------+------+--------------+
| couch        | 57   | 62           | teddy bear   | 77   | 87           |
+--------------+------+--------------+--------------+------+--------------+
| potted plant | 58   | 63           | hair drier   | 78   | 88           |
+--------------+------+--------------+--------------+------+--------------+
| bed          | 59   | 64           | toothbrush   | 79   | 89           |
+--------------+------+--------------+--------------+------+--------------+

.. _face-object-detection-ids:

Face Detection
--------------

This table provides the associated indices for the :class:`model.yolo_face <peekingduck.pipeline.nodes.model.yolo_face.Node>` node.

+------------+----+
| Class name | ID |
+============+====+
| no mask    | 0  | 
+------------+----+
| mask       | 1  |
+------------+----+
